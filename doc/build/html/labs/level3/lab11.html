

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AWS IoT Smarthome &mdash; ARC Labs 2018.09 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Appendix" href="../../appendix/appendix.html" />
    <link rel="prev" title="Level 3 Labs" href="../level3.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ARC Labs
          

          
          </a>

          
            
            
              <div class="version">
                2018.09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../labs.html">Labs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../labs.html#overview">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../labs.html#id2">Labs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../level1.html">Level 1 Labs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../level2.html">Level 2 Labs</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../level3.html">Level 3 Labs</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">AWS IoT Smarthome</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ARC Labs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../labs.html">Labs</a> &raquo;</li>
        
          <li><a href="../level3.html">Level 3 Labs</a> &raquo;</li>
        
      <li>AWS IoT Smarthome</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/labs/level3/lab11.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aws-iot-smarthome">
<span id="lab11"></span><h1>AWS IoT Smarthome<a class="headerlink" href="#aws-iot-smarthome" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Show the smart home solution based on ARC and AWS IoT Cloud</li>
<li>Learn how to use the AWS IoT Cloud</li>
<li>Learn how to use the EMSK Board peripheral modules and on-board resources</li>
</ul>
</div>
<div class="section" id="equipment">
<h2>Equipment<a class="headerlink" href="#equipment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="required-hardware">
<h3>Required Hardware<a class="headerlink" href="#required-hardware" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://www.synopsys.com/dw/ipdir.php?ds=arc_em_starter_kit">[DesignWare ARC EM Starter Kit (EMSK)]</a></li>
<li><a class="reference external" href="https://store.digilentinc.com/pmodwifi-wifi-interface-802-11g/">[Digilent PMOD WiFi (MRF24WG0MA)]</a></li>
<li><a class="reference external" href="https://store.digilentinc.com/pmod-tmp2-temperature-sensor/">[Digilent PMOD TMP2]</a></li>
<li>SD Card</li>
<li>WiFi Hotspot (default SSID: <strong>embARC</strong>, Password: <strong>qazwsxedc</strong>, WPA/WPA2 encrypted)</li>
</ul>
</div>
<div class="section" id="required-software">
<h3>Required Software<a class="headerlink" href="#required-software" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>MetaWare or ARC GNU Toolchain</li>
<li>Serial port terminal (e.g. Putty, Tera-term or Minicom)</li>
</ul>
</div>
<div class="section" id="hardware-connection-emsk-board">
<h3>Hardware Connection (EMSK Board)<a class="headerlink" href="#hardware-connection-emsk-board" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Connect PMOD WiFi to J5, connect PMOD TMP2 to J2.</li>
</ul>
<img alt="hardware connection" src="../../_images/lab11_emsk_connections.png" />
<ul class="simple">
<li>Configure your hardware with proper core configuration.</li>
<li>The hardware resources are described at the table below.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Hardware Resources</th>
<th class="head">Represent</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>BUTTON R</td>
<td>Livingroom Lights Control</td>
</tr>
<tr class="row-odd"><td>LED 0-1</td>
<td>Livingroom Lights Status (On or Off)</td>
</tr>
<tr class="row-even"><td>BUTTON L</td>
<td>Kitchen Lights Control</td>
</tr>
<tr class="row-odd"><td>LED 2-3</td>
<td>Kitchen Lights Status (On or Off)</td>
</tr>
<tr class="row-even"><td>BUTTON X</td>
<td>Front Door Lock Control</td>
</tr>
<tr class="row-odd"><td>LED 4-5</td>
<td>Front Door Lock Status (On or Off)</td>
</tr>
<tr class="row-even"><td>LED 7</td>
<td>WiFi Connection Status (On for connected, Off for not)</td>
</tr>
<tr class="row-odd"><td>LED X</td>
<td>Node Working Status (toggling in 2s period if working well)</td>
</tr>
<tr class="row-even"><td>PMOD TMP2</td>
<td>Temperature Sensor</td>
</tr>
<tr class="row-odd"><td>PMOD WiFi</td>
<td>Provide WiFi Connection</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="content">
<h2>Content<a class="headerlink" href="#content" title="Permalink to this headline">¶</a></h2>
<p>This lab provides instructions on how to establish connection between the EMSK and
Amazon Web Services Internet of Things (AWS IoT) cloud with a simulated smart home application.
With the help of AWS IoT as a cloud platform, devices can securely interact with cloud
applications and other devices. AWS IoT also supports MQ Telemetry Transport (MQTT) and
provides authentication and end-to-end encryption.</p>
<img alt="smarthome system" src="../../_images/lab11_smarthome_system.png" />
<p>This application is designed to show how to connect only 1 EMSK and AWS IoT Cloud
using embARC. The connection between EMSK and AWS IoT Cloud is secured by TLS.</p>
</div>
<div class="section" id="principles">
<h2>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h2>
<p>This lab demonstrates the smart home solution based on EMSK by establishing
the connection between EMSK Board and AWS IoT Cloud. The AWS IoT Device C SDK for the
embedded platform has been optimized and ported for embARC.</p>
<p>In this lab application, the peripheral modules and on-board resources of EMSK board are used
to simulate the objects which are controlled and monitored in smart home scenario. The AWS IoT
Cloud is used as the cloud host and a controlling platform that communicates with the EMSK
Board with MQTT protocol. A HTML5 Web APP is designed to provide
a dash board in order to monitor and control smart home nodes.</p>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-and-setting-smart-home-node">
<h3>Creating and setting smart home node<a class="headerlink" href="#creating-and-setting-smart-home-node" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Create an AWS account at <a class="reference external" href="https://aws.amazon.com/">[Amazon AWS Website]</a>. Amazon offers various account levels,
including a free tier for AWS IoT.</p>
</li>
<li><p class="first">Login AWS console and choose AWS IoT.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_1.png" />
</li>
<li><p class="first">Choose an appropriate IoT server in the top right corner of the AWS IoT console page. As an example we choose US East (N. Virginia) server, you may choose other server as you see fit.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_2.png" />
</li>
<li><p class="first">Create your smart home node in the thing registry and generate X.509 certificate for the
node. Create an AWS IoT policy. Then attach your smart home node and policy to the X.509
certificate.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">for more details, see <a class="reference external" href="http://embarc.org/pdf/embARC_appnote_how_to_use_smart_home_iot.pdf">[Using a Smart Home Iot Application with EMSK]</a></p>
</div>
<img alt="smarthome system" src="../../_images/lab11_steps_3.png" />
</li>
<li><p class="first">Download the root CA certificate from
<a class="reference external" href="https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem">[here]</a>.
Rename it <em>rootCA.crt</em>. Copy the certificate files <em>cert.crt, privateKey.pem and rootCA.crt</em> to folder <em>cert/smarthome</em>.
Insert the SD card to your PC, and copy the certificate folder cert to the SD Card root.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_4.png" />
</li>
<li><p class="first">Open the <a class="reference external" href="http://embarc.org/freeboard/">[Web App]</a> in a web browser and load the configuration file dashboard-smarthomesinglething.json
obtained from <a class="reference external" href="https://github.com/foss-for-synopsys-dwc-arc-processors/embarc_applications/tree/master/aws_iot_smarthome">[embARC/example/freertos/iot/aws/smarthome_demo]</a>. The dashboard can be loaded automatically</p>
<img alt="smarthome system" src="../../_images/lab11_steps_5.png" />
</li>
<li><p class="first">Click “ADD” to go to DATASOURCE page and fill the forms.</p>
</li>
</ol>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">TYPE: Choose AWS IoT.</p>
</li>
<li><p class="first">NAME: Name is aws.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_6.png" />
</li>
<li><p class="first">AWS IOT ENDPOINT: Go to AWS IoT console and click your smart home node “SmartHome”. Copy the content
<code class="docutils literal notranslate"><span class="pre">XXXXXXXXXXXXXX.iot.us-east-1.amazonaws.com</span></code> in REST API endpoint to AWS IOT ENDPOINT.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_7.png" />
</li>
<li><p class="first">REGION: Copy the AWS region of your smart home node in REST API endpoint to REGION. For example,
<code class="docutils literal notranslate"><span class="pre">https://XXXXXXXXXXXXXX.iot.us-east1.amazonaws.com/things/SmartHome/shadow</span></code>. REGION is us-east-1.</p>
</li>
<li><p class="first">CLIENT ID: Leave it blank as default.</p>
</li>
<li><p class="first">ACCESS KEY and SECRET KEY: Go to AWS Services page and click “IAM”.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_8.png" />
<p>Go to User page and click “Create New Users”. Enter User Names “AWSIoTUser”. Then
download user security credentials, Access Key ID and Secret Access Key. Copy Access
Key ID to ACCESS KEY and Secret Access Key to SECRET KEY.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_9.png" />
<p>Go to user page and click “AWSIoTUser”. Click “Attach Policy” to attach “AWSIoTDataAccess” to “AWSIoTUser”.</p>
</li>
<li><p class="first">THINGS: AWS IoT thing name “SmartHome”.</p>
<img alt="smarthome system" src="../../_images/lab11_steps_10.png" />
</li>
<li><p class="first">Click <strong>Save</strong> to finish the setting.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="building-and-running-aws-iot-smart-home-example">
<h3>Building and Running AWS IoT Smart Home Example<a class="headerlink" href="#building-and-running-aws-iot-smart-home-example" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>The AWS IoT thing SDK for C has been ported to embARC. Check the above steps in
order for your IoT application to work smoothly. Go to <em>embARC/example/freertos/iot/aws/smarthome_demo</em>.
Modify aws_iot_config.h to match your AWS IoT configuration. The macro <strong>AWS_IOT_MQTT_HOST</strong> can be copied
from the REST API endpoint in AWS IoT console. For example,
<code class="docutils literal notranslate"><span class="pre">https://XXXXXXXXXXXXXX.iot.us-east-1.amazonaws.com/things/SmartHome/shadow</span></code>. <strong>AWS_IOT_MQTT_HOST</strong> should be
<code class="docutils literal notranslate"><span class="pre">XXXXXXXXXXXXXX.iot.us-east-1.amazonaws.com</span></code>.</li>
</ol>
<blockquote>
<div><img alt="smarthome system" src="../../_images/lab11_builds_1.png" />
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Use USB cable to connect the EMSK board. Set the baud rate of the terminal emulator to 115200.</p>
</li>
<li><p class="first">Insert the SD Card into the EMSK board SD Card slot. Run the AWS IoT application using JTAG.
Go to <em>embARC/example/freertos/iot/aws/smarthome_demo</em> in command-line, run the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make TOOLCHAIN=gnu BD_VER=22 CUR_CORE=arcem7d run</span>
</pre></div>
</div>
</li>
<li><p class="first">FreeRTOS-based runtime environment can be loaded automatically. Wait for WiFi initialization and
connection establishment (30 seconds or less) until the “WiFi connected” message is shown in the
terminal emulator. “Network is ok” is shown after the certificate files cert.crt, privateKey.pem,
and rootCA.crt are validated. The information in “reported”: {} is the state of the EMSK-based
smart home node. “Updated Accepted !!” means the connection works between the smart home node and AWS IoT cloud.</p>
</li>
</ol>
<blockquote>
<div><img alt="smarthome system" src="../../_images/lab11_builds_2.png" />
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Try out functions of EMSK and Dashboard. You can press the button L/R/X to see LED toggling on board, and the status of LEDs also changes on dashboard web app.
You can also click the lights of <em>DESIRED STATUS</em> pane on the dashboard app, and check the reactions of LEDs status on board and dashboard web app.</li>
</ol>
<blockquote>
<div><img alt="smarthome system" src="../../_images/lab11_builds_3.png" />
</div></blockquote>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>This application is designed to show how to connect only 1 EMSK and AWS IoT Cloud using embARC.
Try to add more nodes and implement a Multi-nodes AWS IoT Smarthome Demo.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You could find related demo codes <a class="reference external" href="https://github.com/foss-for-synopsys-dwc-arc-processors/embarc_applications/tree/master/aws_iot_smarthome">[here]</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../appendix/appendix.html" class="btn btn-neutral float-right" title="Appendix" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../level3.html" class="btn btn-neutral" title="Level 3 Labs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Synopsys

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>