

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Memory map and linker &mdash; ARC Labs 2018.09 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="A WiFi temperature monitor" href="lab10.html" />
    <link rel="prev" title="Advanced labs" href="../level2.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ARC Labs
          

          
          </a>

          
            
            
              <div class="version">
                2018.09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../labs.html">Hands-on labs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../level1.html">Basic labs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../level2.html">Advanced labs</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Memory map and linker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#content">Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#principles">Principles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#steps">Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lab10.html">A WiFi temperature monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab7.html">BLE Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab9.html">How to use FreeRTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp1.html">ARC DSP: Compiler Optimizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp2.html">ARC DSP: Using FXAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp3.html">ARC DSP: Using DSP Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../level3.html">Exploration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ARC Labs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../labs.html">Hands-on labs</a> &raquo;</li>
        
          <li><a href="../level2.html">Advanced labs</a> &raquo;</li>
        
      <li>Memory map and linker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/labs/level2/lab8.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="memory-map-and-linker">
<span id="lab8"></span><h1>Memory map and linker<a class="headerlink" href="#memory-map-and-linker" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>To get familiar with memory layout in compilation process</li>
<li>To learn how to use linker</li>
</ul>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The following hardware and tools are required:</p>
<ul class="simple">
<li>PC host</li>
<li>ARC GNU toolchain/MetaWare Development Toolkit</li>
<li>nSIM simulator</li>
<li><code class="docutils literal notranslate"><span class="pre">embarc_osp/arc_labs/labs/lab8_linker</span></code></li>
</ul>
</div>
<div class="section" id="content">
<h2>Content<a class="headerlink" href="#content" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Customizing your program with <strong>compiler pragmas</strong>.</li>
<li>Using “pragma code” to specify a new name of section in which the code of function reside.</li>
<li>Mapping this code section into specified memory location with linker.</li>
<li>Checking the location of this code section after build process.</li>
</ul>
</div>
<div class="section" id="principles">
<h2>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h2>
<p>By default, compiler-generated code is placed in the <em>.text</em> section. The default code section name can be overridden by using the <em>code pragma</em>. After compilation process, the linker automatically maps all input sections from object files to output sections in executable files. If you want to customize the mapping, you can change the default linker mapping by invoking a linker command file.</p>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-project-and-overriding-code-section-name">
<h3>Create a project and overriding code section name<a class="headerlink" href="#create-a-project-and-overriding-code-section-name" title="Permalink to this headline">¶</a></h3>
<p>Open MetaWare IDE, create an empty C project called lab_linker and select ARC EM series processor. Import the main.c and link.cmd files from the <em>embarc_osp/arc_labs/labs/lab8_linker</em> directory into the project.</p>
<p>Open main.c file in MetaWare IDE, use “pragma code” to change the section in which function <code class="docutils literal notranslate"><span class="pre">modify</span></code> reside from <em>.text</em> to a new name “<em>modify_seg</em>”.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma Code (&quot;modify_seg&quot;)</span>
<span class="kt">void</span> <span class="nf">modify</span><span class="p">(</span><span class="kt">int</span> <span class="n">list</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">out</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="n">temp</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">out</span><span class="o">&lt;</span><span class="n">size</span><span class="p">;</span> <span class="n">out</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="n">in</span><span class="o">=</span><span class="n">out</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">in</span><span class="o">&lt;</span><span class="n">size</span><span class="p">;</span> <span class="n">in</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">list</span><span class="p">[</span><span class="n">in</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">in</span><span class="p">];</span>
                <span class="n">list</span><span class="p">[</span><span class="n">in</span><span class="p">]</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
                <span class="n">list</span><span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
            <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#pragma Code ()</span>
</pre></div>
</div>
<p>Pragma code has two forms that must be used in pairs to bracket the affected function definitions:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma code(Section_name)</span>
<span class="cm">/* ----- Affected function definitions go here ---- */</span>
<span class="cp">#pragma code() </span><span class="cm">/* No parameters here */</span><span class="cp"></span>
</pre></div>
</div>
<p>Section_name is a constant string expression that denotes the name of the section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">About detailed usage of the compiler pragmas, see MetaWare C/C++ Programmer’s Guide for the ccac Compiler.</p>
</div>
</div>
<div class="section" id="edit-the-linker-command-file">
<h3>Edit the linker command file<a class="headerlink" href="#edit-the-linker-command-file" title="Permalink to this headline">¶</a></h3>
<p>Open link.cmd file, there are two parts, one is for memory blocks location, the other is for sections mapping.
Add one new block named “<em>MyBlock</em>” in MEMORY, the start address is 0x00002000, and the size is 32KB. Add one new GROUP in SECTIONS, and mapping section “<em>modify_seg</em>” into <em>MyBlock</em>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span> <span class="p">{</span>
    <span class="c1">// Note: overlap of code and data spaces is not recommended since it makes</span>
    <span class="c1">//       Address validity checking impossible with the debugger and simulator</span>
    <span class="nl">MyBlock</span><span class="p">:</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0x00002000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">32</span><span class="n">K</span>
    <span class="nl">MEMORY_BLOCK1</span><span class="p">:</span>  <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0x0010000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">64</span><span class="n">K</span>
    <span class="nl">MEMORY_BLOCK2</span><span class="p">:</span>  <span class="n">ORIGIN</span> <span class="o">=</span> <span class="mh">0x0020000</span><span class="p">,</span> <span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">128</span><span class="n">K</span>
<span class="p">}</span>

<span class="n">SECTIONS</span> <span class="p">{</span>
    <span class="nl">GROUP</span><span class="p">:</span> <span class="p">{</span>
                <span class="nl">modify_seg</span><span class="p">:</span> <span class="p">{}</span>
           <span class="p">}</span><span class="o">&gt;</span><span class="n">MyBlock</span>
<span class="p">......</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">About format and syntax of the linker command file, see MetaWare ELF Linker and Utilities User’s Guide.</p>
</div>
</div>
<div class="section" id="add-the-linker-command-file-into-the-project">
<h3>Add the linker command file into the project<a class="headerlink" href="#add-the-linker-command-file-into-the-project" title="Permalink to this headline">¶</a></h3>
<p>Right-click the current project lab_linker and select Properties. Click <strong>C/C++ build</strong> &gt; <strong>Settings</strong> &gt; <strong>Tool Settings</strong> to open the linker option settings page.</p>
<p><img alt="figure1" src="../../_images/lab8_figure1.png" /></p>
<p>Select Command files to add linker.cmd file into this project.</p>
</div>
<div class="section" id="check-the-result">
<h3>Check the result<a class="headerlink" href="#check-the-result" title="Permalink to this headline">¶</a></h3>
<p>In the linker option settings window, select Map listing to check Generate listing file(=.map)</p>
<p><img alt="figure2" src="../../_images/lab8_figure2.png" /></p>
<p>Build the lab_linker project, then open the lab_linker.map file.</p>
<p><img alt="figure3" src="../../_images/lab8_figure3.png" /></p>
<p>Search SECTIONS SUMMARY, then you can check the size and location of <em>modify_seg</em> section, it resides in <em>MyBlock</em>, similar to you setting in the linker command file.</p>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Check the memory mapping info of <em>modify_seg</em> section by using elfdump tool.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lab10.html" class="btn btn-neutral float-right" title="A WiFi temperature monitor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../level2.html" class="btn btn-neutral" title="Advanced labs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Synopsys

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>