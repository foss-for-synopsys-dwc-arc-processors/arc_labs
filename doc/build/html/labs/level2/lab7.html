

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BLE Communication &mdash; ARC Labs 2018.09 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to use FreeRTOS" href="lab9.html" />
    <link rel="prev" title="A WiFi temperature monitor" href="lab10.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ARC Labs
          

          
          </a>

          
            
            
              <div class="version">
                2018.09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../labs.html">Hands-on labs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../level1.html">Basic labs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../level2.html">Advanced labs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lab8.html">Memory map and linker</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab10.html">A WiFi temperature monitor</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">BLE Communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#content">Content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#principles">Principles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#steps">Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lab9.html">How to use FreeRTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp1.html">ARC DSP: Compiler Optimizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp2.html">ARC DSP: Using FXAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp3.html">ARC DSP: Using DSP Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../level3.html">Exploration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ARC Labs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../labs.html">Hands-on labs</a> &raquo;</li>
        
          <li><a href="../level2.html">Advanced labs</a> &raquo;</li>
        
      <li>BLE Communication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/labs/level2/lab7.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ble-communication">
<span id="lab7"></span><h1>BLE Communication<a class="headerlink" href="#ble-communication" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>To get familiar with the wireless communication in IoT</li>
<li>To get familiar with the usage of RN4020 BLE module on IoT Development Kit</li>
<li>To learn the usage of APIs of RN4020 driver in embARC OSP</li>
</ul>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The following hardware and tools are required:</p>
<ul class="simple">
<li>PC host</li>
<li>A smartphone which supports BLE</li>
<li>ARC GNU toolchain/MetaWare Development Toolkit</li>
<li>ARC board (IoT Development Kit)</li>
<li>embARC OSP package</li>
<li><code class="docutils literal notranslate"><span class="pre">embarc_osp/arc_labs/labs/lab6_ble_rn4020</span></code></li>
</ul>
</div>
<div class="section" id="content">
<h2>Content<a class="headerlink" href="#content" title="Permalink to this headline">¶</a></h2>
<p>The Communication between smartphone and IoT Development Kit board with RN4020 BLE module.</p>
<ul class="simple">
<li>Setup RN4020 BLE module by using API of RN4020 driver.</li>
<li>Connect smartphone and RN4020 by BLE, and check the data send by IoT Development Kit in smartphone.</li>
<li>Send data from smartphone to IoT Development Kit board, and print this data value in terminal.</li>
</ul>
</div>
<div class="section" id="principles">
<h2>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h2>
<p>RN4020 BLE module is controlled by the user through input/output lines (that is physical device pins) and an UART interface.
The UART Interface supports ASCII commands to control/configure the RN4020 modules for any specific requirement based on the application.</p>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>Before connecting an RN4020 module to a smartphone device, you might need to set up the RN4020 module as follows.</p>
<ol class="arabic simple">
<li>Configure UART which is connected to RN4020 with these parameters: <strong>Baud rate - 115200, Data bits - 8, Parity - None, Stop bits - 1</strong></li>
<li>Set the <strong>WAKE_SW</strong> pin high to enter command mode</li>
<li>Run the command <strong>SF, 1</strong> to reset to the factory default configuration</li>
<li>Run the command <strong>SN, IoT DK</strong> to set the device name to be “IoT DK”</li>
<li>Run the command <strong>SS, C0000001</strong> to enable support of the Device Information, Battery Service, and User-Defined Private Service</li>
<li>Run the command <strong>SR, 00002000</strong> to set the RN4020 module as a server</li>
<li>Run the command <strong>PZ</strong> to clear all settings of the private service and the private characteristics</li>
<li>Run the command <strong>PS, 11223344556677889900AABBCCDDEEFF</strong> to set the UUID of user-defined private service to be 0x11223344556677889900AABBCCDDEEFF</li>
<li>Run the command <strong>PC, 010203040506070809000A0B0C0D0E0F, 18, 06</strong> to add private characteristic 0x010203040506070809000A0B0C0D0E0F to current private service. The property of this characteristic is 0x18 (writable and could notify) and has a maximum data size of 6 bytes.</li>
<li>Run the command <strong>R, 1</strong> to reboot the RN4020 module and to make the new settings effective</li>
<li>Run the command <strong>LS</strong> to display the services</li>
</ol>
<p>The source code using the API of RN4020 driver in embARC OSP as follows.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">rn4020_setup(rn4020_ble);</span>
<span class="go">rn4020_reset_to_factory(rn4020_ble);</span>

<span class="go">/* Set device Name */</span>
<span class="go">rn4020_set_dev_name(rn4020_ble, &quot;IoT DK&quot;);</span>

<span class="go">/* Set device services */</span>
<span class="go">rn4020_set_services(rn4020_ble, RN4020_SERVICE_DEVICE_INFORMATION |</span>
<span class="go">                                RN4020_SERVICE_BATTERY |</span>
<span class="go">                                RN4020_SERVICE_USER_DEFINED);</span>

<span class="go">rn4020_set_features(rn4020_ble, RN4020_FEATURE_SERVER_ONLY);</span>
<span class="go">rn4020_clear_private(rn4020_ble);</span>

<span class="go">/* Set private service UUID and private characteristic */</span>
<span class="go">rn4020_set_prv_uuid(rn4020_ble, RN4020_PRV_SERV_HIGH_UUID, RN4020_PRV_SERV_LOW_UUID);</span>
<span class="go">rn4020_set_prv_char(rn4020_ble, RN4020_PRV_CHAR_HIGH_UUID, RN4020_PRV_CHAR_LOW_UUID, 0x18, 0x06, RN4020_PRIVATE_CHAR_SEC_NONE);</span>

<span class="go">/* Reboot RN4020 to make changes effective */</span>
<span class="go">rn4020_reset(rn4020_ble);</span>

<span class="go">rn4020_refresh_handle_uuid_table(rn4020_ble);</span>
</pre></div>
</div>
</div>
<div class="section" id="advertise">
<h3>Advertise<a class="headerlink" href="#advertise" title="Permalink to this headline">¶</a></h3>
<p>Run the command <strong>A</strong> to start advertisement.
The source code using the API of RN4020 driver in embARC OSP as follows.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">rn4020_advertise(rn4020_ble);</span>
</pre></div>
</div>
</div>
<div class="section" id="send-data">
<h3>Send data<a class="headerlink" href="#send-data" title="Permalink to this headline">¶</a></h3>
<p>Run the command <strong>SUW, 2A19, value</strong> to set the level of Battery.
The source code using the API of RN4020 driver in embARC OSP as follows.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">while (1) {</span>

<span class="go">        rn4020_battery_set_level(rn4020_ble, battery--);</span>

<span class="go">        board_delay_ms(1000, 0);</span>
<span class="go">        if (battery &lt; 30) {</span>
<span class="go">                battery = 100;</span>
<span class="go">        }</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">About detailed usage of RN4020 BLE module, see RN4020 Bluetooth Low Energy Module User’s Guide</p>
</div>
</div>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="run-project">
<h3>Run project<a class="headerlink" href="#run-project" title="Permalink to this headline">¶</a></h3>
<p>Open the serial terminal emulator in PC (for example, Tera Term), set as <strong>115200 baud, 8 bits data, 1 stop bit and no parity</strong>, and connect to the IoT Development Kit board.</p>
<p>Open <code class="docutils literal notranslate"><span class="pre">cmd</span></code> from the folder <em>embarc_osp/arc_labs/labs/lab6_ble_rn4020</em>, input the command as follow</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make BOARD=iotdk TOOLCHAIN=gnu run</span>
</pre></div>
</div>
<p>Then the output is displayed in the serial terminal.
<a class="reference internal" href="../../_images/lab7_figure1.png"><img alt="figure1" src="../../_images/lab7_figure1.png" style="width: 550px;" /></a></p>
</div>
<div class="section" id="connection">
<h3>Connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h3>
<p>Open the BLE browser APP in smartphone (for example, LightBlue in IOS), and scan for BLE peripherals, connect the “IoT DK” device.
Then the output is displayed in the serial terminal.
<a class="reference internal" href="../../_images/lab7_figure2.png"><img alt="figure2" src="../../_images/lab7_figure2.png" style="width: 550px;" /></a></p>
<p>And the device information in displayed BLE browser APP.</p>
<p><a class="reference internal" href="../../_images/lab7_figure3.png"><img alt="figure3" src="../../_images/lab7_figure3.png" style="width: 300px;" /></a></p>
</div>
<div class="section" id="communication">
<h3>Communication<a class="headerlink" href="#communication" title="Permalink to this headline">¶</a></h3>
<p>Read the data of Battery services in BLE browser APP. Check whether the data decreases gradually.</p>
<p><a class="reference internal" href="../../_images/lab7_figure4.png"><img alt="figure4" src="../../_images/lab7_figure4.png" style="width: 300px;" /></a></p>
<p>Write data in BLE browser APP. Check the received data in PC serial terminal.</p>
<p><a class="reference internal" href="../../_images/lab7_figure5.png"><img alt="figure5" src="../../_images/lab7_figure5.png" style="width: 300px;" /></a></p>
<p><a class="reference internal" href="../../_images/lab7_figure6.png"><img alt="figure6" src="../../_images/lab7_figure6.png" style="width: 550px;" /></a></p>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Try to use the received data in IoT Development Kit board, and do some control by using GPIO. (for example, LED on/off)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lab9.html" class="btn btn-neutral float-right" title="How to use FreeRTOS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lab10.html" class="btn btn-neutral" title="A WiFi temperature monitor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Synopsys

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>