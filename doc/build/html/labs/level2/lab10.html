

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A WiFi temperature monitor &mdash; ARC Labs 2018.09 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="BLE Communication" href="lab7.html" />
    <link rel="prev" title="Memory map and linker" href="lab8.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ARC Labs
          

          
          </a>

          
            
            
              <div class="version">
                2018.09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../labs.html">Hands-on labs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../level1.html">Basic labs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../level2.html">Advanced labs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lab8.html">Memory map and linker</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">A WiFi temperature monitor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#espb266-wifi-module">ESPB266 WiFi module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lab7.html">BLE Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab9.html">How to use FreeRTOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp1.html">ARC DSP: Compiler Optimizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp2.html">ARC DSP: Using FXAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab_dsp3.html">ARC DSP: Using DSP Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../level3.html">Exploration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ARC Labs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../labs.html">Hands-on labs</a> &raquo;</li>
        
          <li><a href="../level2.html">Advanced labs</a> &raquo;</li>
        
      <li>A WiFi temperature monitor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/labs/level2/lab10.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-wifi-temperature-monitor">
<span id="lab10"></span><h1>A WiFi temperature monitor<a class="headerlink" href="#a-wifi-temperature-monitor" title="Permalink to this headline">¶</a></h1>
<div class="section" id="espb266-wifi-module">
<h2>ESPB266 WiFi module<a class="headerlink" href="#espb266-wifi-module" title="Permalink to this headline">¶</a></h2>
<div class="section" id="purpose">
<h3>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>To learn how to build a wireless sensor terminal based on the embARC OSP package</li>
<li>To know how to use ESP8266 module and AT commands</li>
<li>To learn more about the usage of FreeRTOS operating system</li>
</ul>
</div>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>The following hardware and tools are required:</p>
<ul class="simple">
<li>PC host</li>
<li>GNU Toolchain for ARC Processors / MetaWare Development Toolkit</li>
<li>ARC board (EM Starter Kit / IoT Development Kit)</li>
<li>embARC OSP package</li>
<li><code class="docutils literal notranslate"><span class="pre">embarc_osp/arc_labs/labs/lab10_esp8266_wifi</span></code></li>
</ul>
</div>
<div class="section" id="content">
<h3>Content<a class="headerlink" href="#content" title="Permalink to this headline">¶</a></h3>
<p>Through this lab, you get a preliminary understanding of ESP8266 WiFi module and the AT command.</p>
<p>The lab is based on the embARC OSP package and on the supports of the popular WiFi module, ESP8266.
During the lab, you will first use the AT command to set the ESP8266 to the server mode.
Then you can use your laptop or mobile phone to access ESP8266 by IP address.
You will get a static webpage transmitted via TCP protocol.</p>
</div>
<div class="section" id="principles">
<h3>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h3>
<p><strong>ESP8266</strong></p>
<p>The ESP8266 is an ultra-low-power WiFi chip with industry-leading package size and ultra-low power technology.
It is designed for mobile devices and IoT applications, facilitating the connection between user devices to IoT environments.</p>
<p>The ESP8266 is available with various encapsulations. On-board PCB antenna, IPEX interface, and stamp hole interface are supported.</p>
<p>ESP8266 can be widely used in smart grid, intelligent transportation, smart furniture, handhold devices, industrial control, and other IoT fields.</p>
<p>Ai-Thinker company has developed several WiFi modules based on ESP8266, including ESP01 and ESP01S which will be used in this lab.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See <a class="reference external" href="http://embarc.org/embarc_osp/doc/build/html/getting_started/peripheral_preparation.html#other-pmod-or-compatible-modules">embARC doc</a> to learn how to connect it with your board.</p>
</div>
<p><img alt="figure1" src="../../_images/lab10.2_figure1.png" /></p>
<p><strong>Program structure</strong> is shown below</p>
<p><img alt="figure2" src="../../_images/lab10.2_figure2.png" /></p>
<p><strong>Code</strong> is shown below</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;embARC.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;embARC_debug.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;board.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;esp8266.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#define WIFI_SSID   &quot;\&quot;embARC\&quot;&quot;</span>
<span class="cp">#define WIFI_PWD    &quot;\&quot;qazwsxedc\&quot;&quot;</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">http_get</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;GET /&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">http_IDP</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;+IPD,&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">http_html_header</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;HTTP/1.x 200 OK</span><span class="se">\r\n</span><span class="s">Content-type: text/html</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">http_html_body_1</span><span class="p">[]</span> <span class="o">=</span>
    <span class="s">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;ESP8266_AT_HttpServer&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to this Website&lt;/h1&gt;&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">http_html_body_2</span><span class="p">[]</span> <span class="o">=</span>
    <span class="s">&quot;&lt;p&gt;This Website is used to test the AT command about HttpServer of ESP8266.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">;</span>


<span class="k">static</span> <span class="kt">char</span> <span class="n">http_server_buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">conn_buf</span><span class="p">;</span>

    <span class="c1">//ESP8266 Init</span>
    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;============================ Init ============================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="n">ESP8266_DEFINE</span><span class="p">(</span><span class="n">esp8266</span><span class="p">);</span>
    <span class="n">esp8266_init</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">UART_BAUDRATE_115200</span><span class="p">);</span>
    <span class="n">at_test</span><span class="p">(</span><span class="n">esp8266</span><span class="o">-&gt;</span><span class="n">p_at</span><span class="p">);</span>
    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">//Set Mode</span>
    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;============================ Set Mode ============================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="n">esp8266_wifi_mode_get</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">esp8266_wifi_mode_set</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">//Connect WiFi</span>
    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;============================ Connect WiFi ============================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="k">do</span> <span class="p">{</span>
            <span class="n">esp8266_wifi_scan</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">http_server_buf</span><span class="p">);</span>
            <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;Searching for WIFI %s ......</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">WIFI_SSID</span><span class="p">);</span>
            <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">http_server_buf</span><span class="p">,</span> <span class="n">WIFI_SSID</span><span class="p">)</span><span class="o">==</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;WIFI %s found! Try to connect</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">WIFI_SSID</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">esp8266_wifi_connect</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">WIFI_SSID</span><span class="p">,</span> <span class="n">WIFI_PWD</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AT_OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;WIFI %s connect failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">WIFI_SSID</span><span class="p">);</span>
            <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;WIFI %s connect succeed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">WIFI_SSID</span><span class="p">);</span>

    <span class="c1">//Creat Server</span>
    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;============================ Connect Server ============================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="n">esp8266_tcp_server_open</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="mi">80</span><span class="p">);</span>

    <span class="c1">//Show IP</span>
    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;============================ Show IP ============================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="n">esp8266_address_get</span><span class="p">(</span><span class="n">esp8266</span><span class="p">);</span>
    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">http_server_buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">http_server_buf</span><span class="p">));</span>
            <span class="n">at_read</span><span class="p">(</span><span class="n">esp8266</span><span class="o">-&gt;</span><span class="n">p_at</span> <span class="p">,</span><span class="n">http_server_buf</span> <span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
            <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="c1">//EMBARC_PRINTF(&quot;Alive\n&quot;);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">http_server_buf</span><span class="p">,</span> <span class="n">http_get</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;============================ send ============================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

                    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The message is:</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">http_server_buf</span><span class="p">);</span>

                    <span class="n">conn_buf</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">http_server_buf</span><span class="p">,</span> <span class="n">http_IDP</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
                    <span class="o">*</span><span class="p">(</span><span class="n">conn_buf</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;Send Start</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

                    <span class="n">esp8266_connect_write</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">http_html_header</span><span class="p">,</span> <span class="n">conn_buf</span><span class="p">,</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">http_html_header</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

                    <span class="n">esp8266_connect_write</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">http_html_body_1</span><span class="p">,</span> <span class="n">conn_buf</span><span class="p">,</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">http_html_body_1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

                    <span class="n">esp8266_connect_write</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">http_html_body_2</span><span class="p">,</span> <span class="n">conn_buf</span><span class="p">,</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">http_html_body_2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                    <span class="n">board_delay_ms</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

                    <span class="n">esp8266_CIPCLOSE</span><span class="p">(</span><span class="n">esp8266</span><span class="p">,</span> <span class="n">conn_buf</span><span class="p">);</span>

                    <span class="n">EMBARC_PRINTF</span><span class="p">(</span><span class="s">&quot;Send Finish</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">E_OK</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="steps">
<h3>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h3>
<p><strong>Hardware connection</strong>
(as shown below)</p>
<p><img alt="figure3" src="../../_images/lab10.2_figure3.png" /></p>
<p><strong>Modify the code</strong></p>
<p>Change the WiFi account and password set in the code to connect the particular wifi(as shown below).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>define WIFI_SSID   <span class="s2">&quot;\&quot;embARC\&quot;&quot;</span>
<span class="gp">#</span>define WIFI_PWD    <span class="s2">&quot;\&quot;qazwsxedc\&quot;&quot;</span>
</pre></div>
</div>
<p><strong>Compile and download</strong></p>
<p>Compile and download the program, after downloading successfully, the relevant download information is displayed in the command window(as shown in the following example).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[DIGILENT] This device supports JTAG7 scan formats.</span>
<span class="go">[DIGILENT] Device enumeration: #0 is `IoTDK&#39;=DesignWare ARC SDP.</span>
<span class="go">[DIGILENT] We choose device  : #0 `IoTDK&#39; from 1 possible devices.</span>
<span class="go">[DIGILENT] Product=507 variant=1 fwid=56 firmware-version=10a.</span>
<span class="go">[DIGILENT] It is possible to set the JTAG speed.</span>
<span class="go">[DIGILENT] Current speed is 10000000 Hz.</span>
<span class="go">[DIGILENT] Attempting to set speed to 8000000 Hz.</span>
<span class="go">[DIGILENT] Speed was set to 7500000 Hz.</span>
<span class="go">[DIGILENT] Suppress these messages with environment variable DIG_VERBOSE=0.</span>
<span class="go">Initializing.  System name is ARC_DLL; my DLL was C:/ARC/MetaWare/arc/bin/freertos.</span>
<span class="go">freeRTOS: there are 10 task priorities.</span>
</pre></div>
</div>
<p>At this point, feedback information will be shown on your serial port console, representing the process of the board establishing connection with http server with AT command (showing below).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">embARC Build Time: Nov 22 2018, 14:35:34</span>
<span class="go">Compiler Version: Metaware, 4.2.1 Compatible Clang 4.0.1 (branches/release_40)</span>
<span class="go">=========================== Init ============================</span>
<span class="go">[at_parser_init]57: obj-&gt;psio 0x800066c8 -&gt; 0x80001330</span>
<span class="go">[at_send_cmd]87: command is NULL, send AT test command</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT</span>
<span class="go">&quot; (4)</span>
<span class="go">[at_get_reply]154: &quot;AT</span>

<span class="go">OK&quot; (9)</span>
<span class="go">============================ Set Mode ============================</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CWMODE_CUR?</span>
<span class="go">&quot; (16)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CWMODE_CUR?</span>
<span class="go">+CWMODE_CUR:1</span>

<span class="go">OK&quot; (38)</span>
<span class="go">CWMODE_CUR = 1</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CWMODE_CUR=3</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CWMODE_CUR=3</span>

<span class="go">OK&quot; (24)</span>
<span class="go">============================ Connect WiFi ============================</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CWLAP</span>
<span class="go">&quot; (10)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CWLAP</span>
<span class="go">+CWLAP:(0,&quot;synopsys-guest&quot;,-71,&quot;6c:f3:7f:a8:a1:21&quot;,1,-27,0)</span>
<span class="go">+CWLAP:(5,&quot;Synopsys&quot;,-70,&quot;6c:f3:7f:a8:a1:22&quot;,1,-27,0)</span>
<span class="go">+CWLAP:(0,&quot;synopsys-guest&quot;,-94,&quot;d8:c7:c8:43:5b:81&quot;,1,-19,0)</span>
<span class="go">+CWLAP:(5,&quot;Synopsys&quot;,-95,&quot;d8:c7:c8:43:5b:83&quot;,1,-21,0)</span>
<span class="go">+CWLAP:(0,&quot;iFuture&quot;,-94,&quot;d4:68:ba:06:65:4a&quot;,1,-16,0)</span>
<span class="go">+CWLAP:(4,&quot;iFuture_City&quot;,-93,&quot;d4:68:ba:0e:65:09&quot;,3,-4,0)</span>
<span class="go">+CWLAP:(3,&quot;embARC&quot;,-62,&quot;5e:e0:c5:4f:df:80&quot;,6,32767,0)</span>

<span class="go">OK&quot; (416)</span>
<span class="go">Searching for WIFI &quot;embARC&quot; ......</span>
<span class="go">WIFI &quot;embARC&quot; found! Try to connect</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CWMODE_CUR=1</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CWMODE_CUR=1</span>

<span class="go">OK&quot; (24)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CWJAP_CUR=&quot;embARC&quot;,&quot;qazwsxedc&quot;</span>
<span class="go">&quot; (35)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CWJAP_CUR=&quot;embARC&quot;,&quot;qazwsxedc&quot;</span>
<span class="go">WIFI DISCONNECT</span>
<span class="go">WIFI CONNECTED</span>
<span class="go">WIFI GOT IP</span>

<span class="go">OK&quot; (88)</span>
<span class="go">WIFI &quot;embARC&quot; connect succeed</span>
<span class="go">============================ Connect Server ============================</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPMUX=1</span>
<span class="go">&quot; (13)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPMUX=1</span>

<span class="go">OK&quot; (20)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSERVER=1,80</span>
<span class="go">&quot; (19)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPSERVER=1,80</span>
<span class="go">no change</span>

<span class="go">OK&quot; (37)</span>
<span class="go">============================ Show IP ============================</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIFSR</span>
<span class="go">&quot; (10)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIFSR</span>
<span class="go">+CIFSR:STAIP,&quot;192.168.137.236&quot;</span>
<span class="go">+CIFSR:STAMAC,&quot;5c:cf:7f:0b:5f:9a&quot;</span>

<span class="go">OK&quot; (84)</span>
</pre></div>
</div>
<p><strong>Access server</strong></p>
<p>The serial port feedback information above shows that the board has successfully connected to the target WiFi through ESP8266. It is set to the server mode by using the AT command, and the IP address of the server is also given.</p>
<p>At this point, use a PC or mobile phone to connect to the same WiFi, open a browser(recommend Google Chrome for PC), and enter the IP address to see the static HTTP page. Notice the IP address that you enter should be the same IP address shown in <em>Show IP</em> section at your serial port console. The content of your serial port console browser is shown below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">============================ send ============================</span>

<span class="go">The message is:</span>
<span class="go">0,CONNECT</span>
<span class="go">1,CONNECT</span>

<span class="go">+IPD,0,384:GET / HTTP/1.1</span>
<span class="go">Host: 192.168.137.236</span>
<span class="go">Connection: keep-alive</span>
<span class="go">Upgrade-Insecure-Requests: 1</span>
<span class="go">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36</span>
<span class="go">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span>
<span class="go">Accept-Encoding: gzip, deflate</span>
<span class="go">Accept-Language: zh-CN,zh;q=0.9</span>


<span class="go">Send Start</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSEND=0,44</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;AT+CIPSEND=0,44</span>

<span class="go">OK&quot; (22)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="gp">&gt;</span>
<span class="go">Recv 44 bytes</span>

<span class="go">SEND OK&quot; (30)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSEND=0,93</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPSEND=0,93</span>

<span class="go">OK&quot; (24)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="gp">&gt;</span>
<span class="go">Recv 93 bytes</span>

<span class="go">SEND OK&quot; (30)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSEND=0,93</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPSEND=0,93</span>

<span class="go">OK&quot; (24)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="gp">&gt;</span>
<span class="go">Recv 93 bytes</span>

<span class="go">SEND OK&quot; (30)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPCLOSE=0</span>
<span class="go">&quot; (15)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPCLOSE=0</span>
<span class="go">0,CLOSED</span>

<span class="go">OK&quot; (32)</span>
<span class="go">Send Finish</span>
<span class="go">============================ send ============================</span>

<span class="go">The message is:</span>

<span class="go">+IPD,1,353:GET /favicon.ico HTTP/1.1</span>
<span class="go">Host: 192.168.137.236</span>
<span class="go">Connection: keep-alive</span>
<span class="go">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36</span>
<span class="go">Accept: image/webp,image/apng,image/*,*/*;q=0.8</span>
<span class="go">Referer: http://192.168.137.236/</span>
<span class="go">Accept-Encoding: gzip, deflate</span>
<span class="go">Accept-Language: zh-CN,zh;q=0.9</span>


<span class="go">Send Start</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSEND=1,44</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;AT+CIPSEND=1,44</span>

<span class="go">OK&quot; (22)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="gp">&gt;</span>
<span class="go">Recv 44 bytes</span>

<span class="go">SEND OK&quot; (30)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSEND=1,93</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPSEND=1,93</span>

<span class="go">OK&quot; (24)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="gp">&gt;</span>
<span class="go">Recv 93 bytes</span>

<span class="go">SEND OK&quot; (30)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPSEND=1,93</span>
<span class="go">&quot; (17)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPSEND=1,93</span>

<span class="go">OK&quot; (24)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="gp">&gt;</span>
<span class="go">Recv 93 bytes</span>

<span class="go">SEND OK&quot; (30)</span>
<span class="go">[at_send_cmd]131: at_out: &quot;AT+CIPCLOSE=1</span>
<span class="go">&quot; (15)</span>
<span class="go">[at_get_reply]154: &quot;</span>
<span class="go">AT+CIPCLOSE=1</span>
<span class="go">1,CLOSED</span>

<span class="go">OK&quot; (32)</span>
<span class="go">Send Finish</span>
</pre></div>
</div>
<p><img alt="figure4" src="../../_images/lab10.2_figure4.png" /></p>
</div>
<div class="section" id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h3>
<p>Referring to the embARC documents, using ESP8266 and TCN75 temperature sensor to build http server to make the page display the sensor temperature in real time.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lab7.html" class="btn btn-neutral float-right" title="BLE Communication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lab8.html" class="btn btn-neutral" title="Memory map and linker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Synopsys

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>